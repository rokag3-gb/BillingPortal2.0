{% extends '_base.html' %}
{% load static %}
{% block navbar %}
  {% include '_base_navbar_left.html' %}
{% endblock %}
{% block contents %}
<div class="content">
  {% block navbar-top %}{% include '_base_navbar_top.html' %}{% endblock %}
  <div class="card" style="height: 85vh;">
    {% if request.GET.error == "alreadypaid" %}
      <div class="alert alert-warning alert-dismissible fade show" role="alert">
        선택하신 인보이스는 모두 이미 지불 완료 되었거나 금액이 0원인 인보이스 입니다. 지불을 아직 안한 인보이스를 선택하세요.
        <button class="close" type="button" data-dismiss="alert" aria-label="Close"><span class="font-weight-light" aria-hidden="true">×</span></button>
      </div>
      {% endif %}
    <iframe src="{{ iframe_url }}" width="100%" height="100%" frameborder="0" scrolling="no" allowtransparency="true"></iframe>
  </div>
  {% url 'invoice_list' as invoice_list %}
  {% if request.path == invoice_list %}
  <form action="{% url 'payment' %}" method="POST" id="pass_to_payment" hidden>
    {% csrf_token %}
    <input name="invoice" value="">
  </form>
  <script type="text/javascript">
    function proceed_payment(invoiceIds){
      let form = document.getElementById('pass_to_payment');
      for (let i = 0; i < invoiceIds.length; i++){
        let input = document.createElement("input");
        input.type = "text";
        input.name = "invoice";
        input.value = invoiceIds[i];
        input.id = `invoice_${i}`;
        form.appendChild(input);
      }
      form.submit();
    }
  </script>
  {% endif %}
  <footer>
    {% include '_base_footer.html' %}
  </footer>
</div>
{% endblock %}
